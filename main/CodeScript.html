<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Card + Passcode</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #1E293B;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }

.card {
  background: #0F172A;
  border-radius: 12px;
  overflow: hidden;
  width: 320px!important;  /* üëà ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î */
  max-width: 320px !important;
  color: #fff;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transition: transform 0.3s ease;
}


  .card:hover {
    transform: translateY(-5px);
  }

  .card img {
    width: 100%;
    display: block;
    position: relative;
  }

  .bubble {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #FF416C;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    color: #fff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }

  .card-content {
    padding: 15px;
  }

  .card-content h3 {
    margin: 10px 0;
    font-size: 18px;
    color: #ffffff;
  }

  .card-content p {
    font-size: 14px;
    color: #cbd5e1;
    margin: 5px 0;
  }

  .price {
    font-size: 16px;
    font-weight: bold;
    color: #FF416C;
    margin-top: 10px;
  }

  .price del {
    color: #94a3b8;
    margin-left: 8px;
    font-weight: normal;
  }

  /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ */
  #passcode {
    padding: 8px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    outline: none;
    margin-top: 10px;
    width: calc(100% - 20px);
    box-sizing: border-box;
  }

  #passcode:focus {
    border-color: #3B82F6;
    box-shadow: 0 0 6px rgba(59,130,246,0.5);
  }

.btn {
  display: inline-block;
  margin-top: 10px;
  padding: 8px 16px;
  background: #3B82F6;
  color: #ffffff !important;   /* ‡∏ü‡πâ‡∏≠‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ä‡∏±‡∏î */
  font-weight: bold;           /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô */
  border-radius: 8px;
  text-decoration: none;
  font-size: 14px;
  transition: background 0.3s ease;
  text-align: center;
  cursor: pointer;
}


  .btn:hover {
    background: #2563EB;
  }

#resultBox {
  display: none;
  background: #1E293B;
  padding: 10px;
  border-radius: 8px;
  margin-top: 15px;
  border: 1px solid #475569;
  max-width: 100%;   /* üëà ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */
  word-wrap: break-word; /* üëà ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß */
  overflow-x: auto;  /* üëà ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å‡πÜ ‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ */
}

#codeText {
  white-space: pre-wrap;      /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ñ‡πâ‡∏≤‡∏¢‡∏≤‡∏ß */
  word-wrap: break-word;      /* ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô */
  font-size: 13px;
  color: #f8fafc;
  background: #0F172A;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 10px;
  
  max-width: 100%;            /* ‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î */
  max-height: 200px;          /* üëà ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏ß‡πâ ‡πÄ‡∏ä‡πà‡∏ô 200px */
  overflow-y: auto;           /* üëà ‡∏ñ‡πâ‡∏≤‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô ‚Üí ‡∏°‡∏µ scrollbar ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á */
  overflow-x: auto;           /* üëà ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Å‡∏ß‡πâ‡∏≤‡∏á ‚Üí ‡∏°‡∏µ scrollbar ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
}


</style>
</head>
<body>

<div class="card">
  <div style="position: relative;">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjc-RAUHMFzL656ujwGMUaPr0-JhJfwUg3d-L0NW-EGY4JilcdUiWWV45DlBBStbWFKL5ZCi4acDxb_91Mf660sJG5oD_TIc_MC1p7-ckOOmSbYyCsctfKK0UvAR4a2NQxx5XGU3acdhF0X5xC6erqgBOrd2FmKXY6RqVmZ48bIH14IDl4ueAidy2Y04SGr/s1280/maxresdefault.jpg" alt="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°">
    <div class="bubble">Code Script</div>
  </div>
  <div class="card-content">
    <h3>CodeScript ‡∏ö‡∏≠‡∏ó‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
    <p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>

    <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ -->
    <input type="password" id="passcode" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö">
    <div class="btn" onclick="checkPass()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>

    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <div id="resultBox">
      <div id="codeText">
var LINE_ACCESS_TOKEN = "e6n440XMq48hKrdyZxr4Fp8nKeYXGxBheXauLe+vUq+cjJJJ1/1QwyAhydJ6A3gEv35XYH+/xId/CrEs/1b1crq8gbm6yfe5GGj8+MRbg8WjFoCglFT8Q1mFDCvc4XudL8R8lduZjSUPPvQLI1XS3QdB04t89/1O/w1cDnyilFU=";
var ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1TdSWDTMEAYSYfKsNDcCUTC3jrLO5nTVmfs17C45g9Yc/edit");
var sheetQuestion = ss.getSheetByName("Sheet1");
var sheetAnswer = ss.getSheetByName("Sheet2");

function doPost(e) {
  if (!e) return;

  var data = JSON.parse(e.postData.contents);
  var userId = data.events[0].source.userId;
  var replyToken = data.events[0].replyToken;
  var userMessage = data.events[0].message.text.trim();
  var cache = CacheService.getUserCache();

  if (userMessage === "‡∏™‡∏∏‡πà‡∏°") {
    return sendRandomQuiz(replyToken, userId);
  }

  // ‡∏ñ‡πâ‡∏≤ user ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô bio1
  var questions = sheetQuestion.getDataRange().getValues();
  for (var i = 1; i < questions.length; i++) {
    if (questions[i][0] === userMessage) {
      cache.put(userId, userMessage, 600);
      return sendQuiz(replyToken, questions[i]);
    }
  }

  // ‡∏ñ‡πâ‡∏≤ user ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
  var questionKey = cache.get(userId);
  if (questionKey) {
    return checkAnswerAndSendNext(replyToken, userMessage, questionKey, userId);
  } else {
    return replyText(replyToken, "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‡πÄ‡∏ä‡πà‡∏ô Sci1 ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå '‡∏™‡∏∏‡πà‡∏°' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡πà‡∏∞");
  }
}

function sendRandomQuiz(replyToken, userId) {
  var cache = CacheService.getUserCache();
  var questions = sheetQuestion.getDataRange().getValues();
  const randomIndex = Math.floor(Math.random() * (questions.length - 1)) + 1;
  const row = questions[randomIndex];
  const keyword = row[0];

  cache.put(userId, keyword, 600);
  return sendQuiz(replyToken, row);
}

function sendQuiz(replyToken, row, additionalMessage = "") {
  var question = row[1];
  var choices = row.slice(2, 6);

  // ‡∏≠‡πà‡∏≤‡∏ô label ‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏•‡∏•‡πå C1:F1
  var labelRange = sheetQuestion.getRange("C1:F1").getValues();
  var labels = labelRange[0];

  var buttons = choices.map((choice, index) => {
    var label = labels[index] || String.fromCharCode(65 + index);
    return {
      "type": "button",
      "action": {
        "type": "message",
        "label": label + ". " + choice,
        "text": label + ". " + choice
      },
      "style": "secondary",
      "height": "sm",
      "margin": "sm"
    };
  });

  var flexMessage = {
    "type": "flex",
    "altText": "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
    "contents": {
      "type": "bubble",
      "body": {
        "type": "box",
        "layout": "vertical",
        "contents": [
          {
            "type": "text",
            "text": "‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
            "weight": "bold",
            "size": "lg"
          },
          {
            "type": "text",
            "text": question,
            "wrap": true,
            "margin": "md"
          },
          {
            "type": "separator",
            "margin": "md"
          },
          {
            "type": "box",
            "layout": "vertical",
            "spacing": "sm",
            "margin": "md",
            "contents": buttons
          }
        ]
      }
    }
  };

  replyMixed(replyToken, additionalMessage, flexMessage);
}


function checkAnswerAndSendNext(replyToken, userAnswer, questionKey, userId) {
  var answers = sheetAnswer.getDataRange().getValues();
  var foundResult = null;
  var correctAnswer = null;

  // ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏à‡∏≤‡∏Å sheetAnswer
  for (var i = 1; i < answers.length; i++) {
    if (answers[i][0].trim() === userAnswer.trim() && answers[i][2] === questionKey) {
      foundResult = answers[i][1]; // "‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î"
    }
    if (answers[i][1] === "‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å" && answers[i][2] === questionKey) {
      correctAnswer = answers[i][0];
    }
  }

  var cache = CacheService.getUserCache();
  var message = "";

  if (foundResult === "‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å") {
    var countStr = cache.get(userId + "_correctCount");
    var count = countStr ? parseInt(countStr) : 0;
    count++;
    cache.put(userId + "_correctCount", count.toString(), 600);

    message = "‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Ñ‡∏≥‡πÄ‡∏â‡∏•‡∏¢: " + correctAnswer;

    if (count >= 5) {
      message += "\nüéâ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô " + count + " ‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!";
    }

  } else {
    // ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î ‡∏£‡∏µ‡πÄ‡∏ã‡∏ï count
    message = "‚ùå ‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: " + (correctAnswer || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    cache.remove(userId + "_correctCount");
  }

  // ‡∏•‡∏ö cache ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
  cache.remove(userId);

  // ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
  var questions = sheetQuestion.getDataRange().getValues();
  const randomIndex = Math.floor(Math.random() * (questions.length - 1)) + 1;
  const newRow = questions[randomIndex];
  const newKey = newRow[0];

  cache.put(userId, newKey, 600);
  return sendQuiz(replyToken, newRow, message);
}

function replyText(replyToken, msg) {
  UrlFetchApp.fetch("https://api.line.me/v2/bot/message/reply", {
    "method": "post",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + LINE_ACCESS_TOKEN,
    },
    "payload": JSON.stringify({
      "replyToken": replyToken,
      "messages": [{
        "type": "text",
        "text": msg
      }]
    })
  });
}

function replyMixed(replyToken, textMsg, flexMsg) {
  const messages = [];

  if (textMsg) {
    messages.push({
      "type": "text",
      "text": textMsg
    });
  }

  messages.push(flexMsg);

  UrlFetchApp.fetch("https://api.line.me/v2/bot/message/reply", {
    "method": "post",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + LINE_ACCESS_TOKEN,
    },
    "payload": JSON.stringify({
      "replyToken": replyToken,
      "messages": messages
    })
  });
}

      </div>
      <div class="btn" onclick="copyCode()">Copy</div>
<a href="https://docs.google.com/spreadsheets/d/1TdSWDTMEAYSYfKsNDcCUTC3jrLO5nTVmfs17C45g9Yc/edit?usp=sharing" class="btn" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î Sheet</a>        
    </div>
  </div>
</div>

<script>
function checkPass() {
  const code = document.getElementById("passcode").value;
  if (code === "1234") {
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    document.getElementById("resultBox").style.display = "block";

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°
    document.getElementById("passcode").style.display = "none";
    document.querySelector(".card-content .btn").style.display = "none";
  } else {
    alert("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
  }
}


  function copyCode() {
    const text = document.getElementById("codeText").innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert("Copy successful!");
    });
  }
</script>

</body>
</html>
